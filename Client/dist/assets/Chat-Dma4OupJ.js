import{n as y,c as w,r,j as e}from"./index-DDg8tmzP.js";import{u as b,a as I,b as E,B as T,c as R,d as B,e as O,f as D,E as F,g as A,h as $,i as P,T as L}from"./index-CdBepGEp.js";import{M as k}from"./index-XLCXBP2A.js";import{f as V}from"./format-D5IGutSq.js";function G({conversation:s,lastIdx:t}){const{selectedConversation:l,setSelectedConversation:a}=b(),n=(l==null?void 0:l._id)===s._id,{onlineUsers:d,unreadMessages:o,markAsRead:i}=y(),x=d.includes(s._id),c=w(f=>f.user.user),u=o[s._id]||0,j=u>0,p=()=>{a(s),i(c==null?void 0:c._id,s._id)};return r.useEffect(()=>{l&&i(c==null?void 0:c._id,l==null?void 0:l._id)},[l]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`flex gap-2 items-center hover:bg-sky-500  p-2 py-2 cursor-pointer ${n?"bg-gray-500":""}`,onClick:()=>p(),children:[e.jsx("div",{className:`avatar ${x?"online":""}`,children:e.jsx("div",{children:e.jsx("img",{src:(s==null?void 0:s.profile)||"/assets/doc.png",alt:"user avatar",className:"w-8 rounded-full border-2 "})})}),e.jsx("div",{className:"flex flex-col flex-1",children:e.jsxs("div",{className:"flex gap-3 justify-between",children:[e.jsxs("p",{className:"font-semibold",children:["(DR) ",s==null?void 0:s.name]}),x?e.jsx("span",{className:"text-green-500 font-bold text-sm",children:"Online"}):e.jsx("span",{className:"text-gray-500 font-bold text-sm",children:"Offline"}),j&&e.jsxs("span",{className:"text-green-500 font-bold text-sm",children:["Messages ",u]})]})})]}),!t&&e.jsx("div",{className:"divider my-0 py-0 h-1"})]})}function U(){const{loading:s,conversations:t}=I(),{selectedConversation:l}=b(),a=l?[l,...t.filter(n=>n._id!==l._id)]:t;return e.jsxs("div",{children:[a.map((n,d)=>e.jsx(G,{conversation:n,lastIdx:d===a.length-1},n==null?void 0:n._id)),s?e.jsx("span",{className:"loading loading-spinner mx-auto",children:"Loading.."}):null]})}function q(){return e.jsxs("div",{className:"w-1/4 bg-white border-r h-full overflow-y-auto",children:[e.jsx("div",{className:"p-4 bg-blue-700 h-[50px] text-white flex justify-between items-center"}),e.jsx("div",{className:"divider px-3"}),e.jsx(U,{})]})}function z(){const[s,t]=r.useState(""),[l,a]=r.useState(!1),[n,d]=r.useState(!1),[o,i]=r.useState(null),[x,c]=r.useState(null),{loading:u,sendMessage:j}=E(),{startTyping:p,stopTyping:f}=y();r.useEffect(()=>{s?p():f()},[s,p,f]);const N=m=>{t(_=>_+m.emoji)},h=async m=>{m.preventDefault(),!(!s&&!x)&&(s?await j(s):x&&await j(x),t(""),c(null))},g=()=>d(!0),v=()=>d(!1),M=m=>i(m.blob),S=async()=>{o&&(await j(o),i(null))},C=m=>{c(m.target.files[0])};return e.jsxs("form",{className:"px-4 my-3",onSubmit:h,children:[e.jsxs("div",{className:"w-full relative bg-white border-t",children:[e.jsx("input",{type:"text",className:"border text-sm rounded-lg block w-full p-2.5 focus:outline-none focus:ring focus:ring-green-500",placeholder:"Send a message",value:s,onChange:m=>t(m.target.value)}),e.jsx("button",{type:"button",className:"absolute inset-y-0 end-28 flex items-center pe-3",onClick:()=>a(!l),children:e.jsx(T,{})}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",id:"image-upload",onChange:C}),e.jsx("label",{htmlFor:"image-upload",className:"absolute inset-y-0 end-20 flex items-center pe-3 cursor-pointer",children:e.jsx(R,{})}),e.jsx("button",{type:"button",className:"absolute inset-y-0 end-10 flex items-center pe-3",onClick:n?v:g,children:n?e.jsx(B,{}):e.jsx(O,{})}),e.jsx("button",{type:"submit",className:"absolute inset-y-0 end-0 flex items-center pe-3",children:u?e.jsx("div",{className:"loading loading-spinner"}):e.jsx(D,{})}),l&&e.jsx("div",{className:"absolute bottom-10 right-0 z-50",children:e.jsx(F,{onEmojiClick:N})}),e.jsx(A.ReactMic,{record:n,className:"hidden",onStop:M,mimeType:"audio/webm"})]}),o&&e.jsxs("div",{className:"flex justify-end mt-2",children:[e.jsx("button",{type:"button",className:"text-white bg-red-500 hover:bg-red-700  px-4 py-2",onClick:()=>{v(),i(null)},children:"Cancel"}),e.jsx("button",{type:"button",className:"text-white bg-green-500 hover:bg-green-700  px-4 py-2",onClick:S,children:"Send Voice Message"})]}),x&&e.jsxs("div",{className:"flex justify-end mt-2",children:[e.jsx("button",{type:"button",className:"text-white bg-red-500 hover:bg-red-700  px-4 py-2",onClick:()=>c(null),children:"Cancel"}),e.jsx("button",{type:"button",className:"text-white bg-green-500 hover:bg-green-700  px-4 py-2",onClick:h,children:"Send Image"})]})]})}const W=()=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx("div",{className:"skeleton w-10 h-10 rounded-full shrink-0"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("div",{className:"skeleton h-4 w-40"}),e.jsx("div",{className:"skeleton h-4 w-40"})]})]}),e.jsxs("div",{className:"flex gap-3 items-center justify-end",children:[e.jsx("div",{className:"flex flex-col gap-1",children:e.jsx("div",{className:"skeleton h-4 w-40"})}),e.jsx("div",{className:"skeleton w-10 h-10 rounded-full shrink-0"})]})]});k.setAppElement("#root");function H({message:s}){const t=w(h=>h.user.user),{selectedConversation:l}=b(),[a,n]=r.useState(!1),d=s.senderId===(t==null?void 0:t._id),o=d?"justify-end":"justify-start",i=d?"bg-blue-500":"bg-gray-700",x=V(new Date(s.createdAt),"p"),c=s.messageType==="voice",u=s.messageType==="image";if(!(s.senderId===l._id||s.senderId===t._id&&s.receiverId===t._id||s.receiverId===l._id))return null;const p=()=>{n(!0)},f=()=>{n(!1)},N=()=>{const h=s.message;if(!h){console.error("Invalid URL");return}const g=document.createElement("a");g.href=h,g.setAttribute("download",`image_${Date.now()}.jpg`),document.body.appendChild(g),g.click(),document.body.removeChild(g)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`flex ${o} mb-4 mt-2`,children:e.jsxs("div",{className:`relative max-w-xs px-4 py-2 text-white rounded-lg ${i}`,children:[c?e.jsx("video",{className:"h-14 w-64",src:s==null?void 0:s.message,controls:!0}):u?e.jsx("img",{src:s.message,alt:"Sent image",className:"max-w-full h-auto rounded-lg",onClick:p}):e.jsx("p",{children:s.message}),e.jsx("div",{className:"text-xs text-black-400 mt-1",children:x})]})}),u&&e.jsx(k,{isOpen:a,onRequestClose:f,contentLabel:"Image Preview",className:"flex items-center justify-center",overlayClassName:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-lg w-full mx-4 flex flex-col items-center",children:[e.jsx("div",{className:"w-[290px] h-[290px] flex items-center justify-center mb-4",children:e.jsx("img",{src:s.message,alt:"Image Preview",className:"object-contain max-w-full max-h-full"})}),e.jsx("button",{onClick:N,className:"bg-blue-500 text-white px-4 py-2 w-[115px] mb-4",children:"Download"}),e.jsx("button",{onClick:f,className:"bg-gray-500 text-white px-4 py-2 w-[115px]",children:"Close"})]})})]})}function J(){const{messages:s,loading:t}=$();P();const l=r.useRef();return r.useEffect(()=>{setTimeout(()=>{var a;(a=l.current)==null||a.scrollIntoView({behavior:"smooth"})},100)},[s]),e.jsxs("div",{className:"px-4 flex-1 overflow-auto",children:[!t&&s.length>0&&s.map(a=>e.jsx("div",{ref:l,children:e.jsx(H,{message:a})},a._id)),t&&[...Array(3)].map((a,n)=>e.jsx(W,{},n)),!t&&s.length===0&&e.jsx("p",{children:"Send message to start a conversation"})]})}function K(){const{selectedConversation:s,setSelectedConversation:t}=b(),{onlineUsers:l,typingUsers:a,startTyping:n,stopTyping:d}=y(),o=l.includes(s==null?void 0:s._id);return r.useEffect(()=>()=>t(null),[t]),e.jsx("div",{className:"flex-1 flex flex-col",children:s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-between p-4 bg-blue-700 text-white",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:(s==null?void 0:s.profile)||"/assets/doc.png",alt:s==null?void 0:s.name,className:"w-12 h-12 rounded-full mr-4"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["DR ",s==null?void 0:s.name]}),e.jsx("span",{className:"text-sm text-gray-300",children:a.some(i=>(i==null?void 0:i.userId)===(s==null?void 0:s._id))?"Typing...":o?"Online":""})]})]})}),e.jsx(J,{}),e.jsx(z,{})]}):e.jsx(Q,{})})}const Q=()=>{const s=w(t=>t.user);return e.jsx("div",{className:"flex items-center justify-center w-full h-full bg-black",children:e.jsxs("div",{className:"px-4 text-center sm:text-xl text-green-200 font-semibold flex flex-col items-center gap-2",children:[e.jsxs("p",{children:["Welcome ",s==null?void 0:s.name]}),e.jsx("p",{children:"Select a chat to start messaging"}),e.jsx(L,{className:"text-3xl md:text-6xl text-center"})]})})};function se(){return e.jsxs("div",{className:"flex h-[88vh] bg-gray-200",children:[e.jsx(q,{}),e.jsx(K,{})]})}export{se as default};
